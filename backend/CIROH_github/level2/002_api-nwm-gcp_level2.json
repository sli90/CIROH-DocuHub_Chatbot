[
  {
    "metadata": {
      "idurl": 2,
      "title": "api-nwm-gcp",
      "source": "https://github.com/CIROH-UA/api-nwm-gcp",
      "section_header": "# api-nwm-gcp",
      "parent_header": "# api-nwm-gcp",
      "order": 1,
      "current_header": "## Project Objective"
    },
    "content": "The **api-nwm-gcp** repository provides a REST API backed by National Water Model (NWM) data, developed on Google Cloud Platform (GCP). It enables users to access hydrologic and geospatial data through cloud-based infrastructure and deployment."
  },
  {
    "metadata": {
      "idurl": 2,
      "title": "api-nwm-gcp",
      "source": "https://github.com/CIROH-UA/api-nwm-gcp",
      "section_header": "# api-nwm-gcp",
      "parent_header": "# api-nwm-gcp",
      "order": 2,
      "current_header": "## Core Functionalities"
    },
    "content": "- REST API for accessing National Water Model (NWM) data.  \n- Cloud infrastructure setup using Terraform and Google Cloud SDK.  \n- Automated deployment using Cloud Build and Cloud Run.  \n- API management with Google API Gateway.  \n- Example API endpoints for geometry, analysis-assimilation data, and forecast data.  \n- Includes infrastructure configuration for service accounts, permissions, and Docker image storage in Artifact Registry."
  },
  {
    "metadata": {
      "idurl": 2,
      "title": "api-nwm-gcp",
      "source": "https://github.com/CIROH-UA/api-nwm-gcp",
      "section_header": "# api-nwm-gcp",
      "parent_header": "# api-nwm-gcp",
      "order": 3,
      "current_header": "## Technical Stack"
    },
    "content": "- **Cloud Services:** Google Cloud Platform (Cloud Run, API Gateway, Cloud Build, Artifact Registry).  \n- **Infrastructure Management:** Terraform.  \n- **Languages/Tools:** Docker, gcloud CLI, terraform CLI.  \n- **Deployment Configuration:** cloudbuild.yaml, deployment.tfvars."
  },
  {
    "metadata": {
      "idurl": 2,
      "title": "api-nwm-gcp",
      "source": "https://github.com/CIROH-UA/api-nwm-gcp",
      "section_header": "# api-nwm-gcp",
      "parent_header": "# api-nwm-gcp",
      "order": 4,
      "current_header": "## Setup and Usage"
    },
    "content": "### Infrastructure Setup  \n1. Authenticate with gcloud:  \n   ```bash\n   gcloud auth application-default login\n   ```  \n2. Update variables in `deployment.tfvars` with project-specific details.  \n3. Initialize Terraform:  \n   ```bash\n   terraform init\n   ```  \n4. (Optional) Preview deployment plan:  \n   ```bash\n   terraform plan -var-file=\"deployment.tfvars\"\n   ```  \n5. Deploy infrastructure:  \n   ```bash\n   terraform apply -var-file=\"deployment.tfvars\"\n   ```  \n6. (Optional) Destroy infrastructure:  \n   ```bash\n   terraform destroy -var-file=\"deployment.tfvars\"\n   ```\n\n### Deployment  \n#### Initial Docker Build and Cloud Run Deploy  \n1. Ensure Cloud Build service account has **Cloud Run Admin** and **Service Account User** roles enabled.  \n2. Submit a Cloud Build job:  \n   ```bash\n   gcloud builds submit --config cloudbuild.yaml\n   ```  \n3. Modify Cloud Run parameters in `cloudbuild.yaml` if necessary.\n\n#### Deploy API Gateway  \n1. Create the API:  \n   ```bash\n   gcloud api-gateway apis create API_ID --project=PROJECT_ID\n   ```  \n2. Create the API config:  \n   ```bash\n   gcloud api-gateway api-configs create CONFIG_ID --api=API_ID --openapi-spec=API_DEFINITION --project=PROJECT_ID --backend-auth-service-account=SERVICE_ACCOUNT_EMAIL\n   ```  \n3. Deploy an API config to a gateway:  \n   ```bash\n   gcloud api-gateway gateways create GATEWAY_ID --api=API_ID --api-config=CONFIG_ID --location=GCP_REGION --project=PROJECT_ID\n   ```\n\n### Example Use  \n#### Geometry  \n```bash\ncurl -H \"x-api-key: ${API_KEY}\" \"${NWM_API}/geometry?lon=-121.76&lat=37.70\"\n```  \n#### Analysis Assimilation Data  \n```bash\ncurl -H \"x-api-key: ${API_KEY}\" \"${NWM_API}/analysis-assim?start_time=2018-09-17&end_time=2023-05-01&comids=15059811&output_format=csv\"\n```  \n#### Forecast Data  \n```bash\ncurl -H \"x-api-key: ${API_KEY}\" \"${NWM_API}/forecast?forecast_type=long_range&reference_time=2023-05-01&ensemble=0&comids=15059811&output_format=csv\"\n```"
  },
  {
    "metadata": {
      "idurl": 2,
      "title": "api-nwm-gcp",
      "source": "https://github.com/CIROH-UA/api-nwm-gcp",
      "section_header": "# api-nwm-gcp",
      "parent_header": "# api-nwm-gcp",
      "order": 5,
      "current_header": "## Project Context & Domain"
    },
    "content": "- **Domain:** Hydrology / Cloud Infrastructure / API Development.  \n- **Affiliation:** Not specified.  \n- **Purpose:** Provide cloud-based access to National Water Model data through a REST API deployed on Google Cloud Platform."
  },
  {
    "metadata": {
      "idurl": 2,
      "title": "api-nwm-gcp",
      "source": "https://github.com/CIROH-UA/api-nwm-gcp",
      "section_header": "# api-nwm-gcp",
      "parent_header": "# api-nwm-gcp",
      "order": 6,
      "current_header": "## Input / Output"
    },
    "content": "**Input:**  \n- API parameters such as longitude/latitude, forecast type, time range, ensemble ID, and COMIDs.  \n**Output:**  \n- JSON or CSV-formatted responses containing geometry, analysis-assimilation, or forecast data from the National Water Model."
  }
]